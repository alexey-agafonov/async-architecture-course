# 0-я неделя. Черновой проект системы

# Cервисы

## Auth Service
Сервис используется для хранения настроек профиля и прав доступа. В авторизационном токене мы получаем инфу о пользователе, его роли и в зависимости от ролей можем либо назначать задачи, либо пользоваться аналитикой и т. д.

Сервис будет отдавать профиль пользователя похожем на такой формат:

```json
{
    "id": 123,
    "first_name": "Alex",
    "last_name": "Agafonov",
    "email": "alex.agafonov@gmail.com",
    "resource_access": {
      "roles": [
        "admin"
      ] 
    }
}
```

Выделяем его в отдельный сервис, т. к. нам в каждом нашем сервисе необходима единация аутентификация и авторизация пользователя.
В такой схеме этот сервис может стать бутылочным горлышком, поэтому надо продумать как его скейлить, сколько реплик сервиса иметь.

## Task Tracker Service
Сервис служит для создания, назначения и трекинга задач, так же выносим его в отдельный, потому что подходит под отдельную доменную область. 
Здесь будет проходить весь жизненный цикл задач и показываться связь попугов с задачами.

Cервис пушит в EventBus события примерно в таком формате:

При создании задачи:

```json
{
    "date": "2022-09-24T10:06:39.200Z",
    "description": "new task",
    "popug_id": 111,
    "price": 12
}
```

При ассайне задачи:

```json
{
    "date": "2022-09-24T10:06:39.389Z",
    "task_id": 111,
    "popug_id": 123
}
```

При закрытии задачи:

```json
{
    "date": "2022-09-24T10:06:39.389Z",
    "task_id": 111,
    "popug_id": 123,
    "price": 12
}
```

## Accounting Service
Сервис будет заниматься различными денежными расчётами, выносим отдельно, потому что расчёты могут быть долгие и тяжёлые и они не должны влиять на работу основного сервиса.
Подписывается на события назначения и завершения задач Task Tracker Service. Отправляет события о назначении и стоимости в EventBus:

```json
{
    "task_id": 123,
    "assign_price": -12,
    "done_price": 12,
    "date": "2022-09-24T10:06:39.389Z"
}
```

В конце дня после получения итоговой суммы по каждому попугу и отправляет события в EventBus, после этого Mail Service разошлёт информацию попугам:

```json
{
    "date": "2022-09-24T10:05:39.401Z",
    "total_amount": 111,
    "popug_id": 123
}
```

## Analytics Service

Сервис аналитики слушает события о завершении тасок, а затем агрегирует статистику и отображает дашборд попугам.

## Mail Service

Сервис отправки уведомлений получает события и пытается их отправить.

## Коммуникация между сервисами

Общение между попугами и дашбордами обычные синхронные http-запросы, а общение между микросервисами асинхронное через события в EventBus.
